from mathflow import Expression
from sympy.abc import x, c
from sympy import Expr, Symbol
from itertools import zip_longest

def n(n, c):
    return ((n - 1)*c**n + x)/(n*c**(n - 1))

_c: float | Symbol = 1
_n: int = 4
f0 = n(_n, _c)
# print(f0)
# exit()
fn = f0
for _ in range(3):
    fn = n(_n, fn)
fn = Expression(fn)
fn = fn.combsimp()
n: Expr
d: Expr
n, d = fn.as_numer_denom()
n, d = n.expand(), d.expand()

# from sympy import latex
# print(latex(n))
# print(latex(d))
n_coeffs = n.as_poly().all_coeffs()
d_coeffs = d.as_poly().all_coeffs()
print(n_coeffs)
print(d_coeffs)
coeffs = []
for i, j in zip_longest(n_coeffs, d_coeffs, fillvalue=None):
    coeffs.append(i)
    coeffs.append(j)
while None in coeffs: coeffs.remove(None)
print(coeffs)

"""
==== Combined Coeffs ====
Cube Root:
iter0: [1, 3, 2]
iter1: [2, 9, 12, 36, 51, 36, 16]
iter2: [16, 108, 288, 1728, 3681, 15012, 27276, 77544, 123624, 257283, 337320, 505548, 560838, 505548, 408096, 203904, 124992, 27648, 8192]
iter3: [8192, 82944, 442368, 4313088, 14876352, 124343424, 353682432, 2484981504, 6323577120, 37660256964, 88302470976, 452821002912, 989902408338, 4432308777612, 9084129344136, 35866242405720, 69150618041904, 242236115089209, 440329494605232, 1373388536239164, 2356902051923736, 6556367881625076, 10627655586190848, 26372671473714768, 40368266694341676, 89251288066088892, 128875937554971288, 253156896312715584, 344214898707237651, 598017177085017024, 763555464718081380, 1165574965550290560, 1392162442848519444, 1850824365708342852, 2057515597230360480, 2355512603978747664, 2422080881965462272, 2355512603978747664, 2224127969997938496, 1810250005017286656, 1557678478927626432, 1044319692622814208, 812040321316018176, 440240689774264320, 306110778619428864, 130919943425900544, 80204252304900096, 26078391603560448, 13753576208203776, 3204904264925184, 1399822787543040, 210909737779200, 71462887096320, 5566277615616, 1099511627776]

Fourth Root:
iter0: [1, 4, 2]
iter1: [3, 16, 36, 144, 162, 432, 580, 432, 243]
iter2: [243, 1728, 11664, 77760, 262440, 1632960, 3822640, 21670848, 41168340, 205654464, 346123152, 1479943872, 2311181208, 8313356736, 12287794608, 36935960256, 51770245554, 129753617472, 171389329200, 355966136128, 439534043928, 742358878272, 847334588688, 1118355114816, 1172817593940, 1118355114816, 1030291232688, 659165719104, 524761849512, 202338720576, 134696910096, 24794911296, 10460353203]
iter3: [10460353203, 99179645184, 2008387814976, 18744952939776, 189792648515232, 1743280623399168, 11801626616928960, 106547312877219072, 544553681130679248, 4821978799657675008, 19929791285608696128, 172590401510712771840, 603618419809068581088, 5094631057957010936064, 15579212737117590963648, 127674456212563986615552, 350009295851566367695080, 2774533634083786448113920, 6954607953420113911588416, 53131133324451533975555328, 123711847942439546037868320, 907859661520904898087926016, 1988886379404140657923776192, 13980426235304224557768185088, 29115054231671839259922908016, 195587192174995256304680702208, 390422361789122776329873787200, 2502207076627388851613707504896, 4819148133757498744558010017632, 29431317311435227879411050445056, 54973880240796214798685218273728, 319696473021389325695796248302848, 581475538173269474658575861451156, 3218982855763106682542130413075712, 5718748876130384523211486211272512, 30136559180473285763460969389508864, 52418188539496361843352568323904032, 263014353919710886097691150442398976, 448677896013531343461271887540854208, 2144384316460731457617765380221153536, 3592411625373826819725408147276483792, 16361662335815851944001077613318790400, 26943085092031261980798029797401321024, 116997830506184819238771470507499432192, 189507413492462675616479872112345440608, 784973743880975556123898714352631489792, 1251229625497809667979060594245124453568, 4945980634724755995999402953199574962432, 7760825131407549074734593378952569018456, 29286385730278544704492337284185325638912, 45246666267525499314955253823676654525248, 163043534237655452617669482987580458696960, 248053265386333185648704860813780037425824, 853676916251085577169044144608422218063104, 1279035104760812078269148774538611568137664, 4204246397563406511216814306392552120461568, 6203386559347835754825713237933599229980656, 19474604312049195659564364938847889041216768, 28297353618177168577891804614786631638399552, 84829586412248767866762396393981488232710400, 121374685743856734048321540852850371352558560, 347351360278153945128237832098194024881151232, 489331930698064132196376118126070672662981824, 1336320460300012582191199599020716050154465536, 1853242499419170628401902081830978969695868914, 4827032472549417784894404338700971095075683072, 6588777281418247550283566768824294706903229120, 16357404285981600051070040056825154825814789888, 21970481436068943498218594536164448266157978080, 51948686972795942885269439287727461414986068736, 68640189599109132618150110133083519470364536896, 154433754681091791969911121057079095467478034176, 200669813918883903055539290965138329492123358704, 429153500888138669305450355520351486802613459712, 548179671821963081576492045301936895627691060160, 1112980628164209185880851058981124306047243857664, 1396941211210544910550490319047615262624472789152, 2688849553104262571284662208638938812724990595840, 3314515026603192629753156559184882138233855930688, 6038601886620442142335391449975340353684094174976, 7306438604330419691774701548835473312682286110296, 12576521417093474248371430786848102111711684932352, 14926766600206253520219382491880005026106430118592, 24225106554568473993869857027401397538640110724864, 28183216841285401103573108798653157663818124068704, 43025752338230415036881759969073126676109998959360, 49024931123856681136944563461794766118824458454080, 70219991276814422150083487379872783836618637393664, 78291289960922743692194601713337520311158253060816, 104904722803863734363178384329383533226279933293312, 114331325255463821686639266401676308882107491263424, 142846591868929625202270864197968342596262355937024, 152005874388621174637914641859959558977187885848608, 176448010721976015258937552586712772510254404463360, 183095071702468261869412833065275437044170089051456, 196674645821672899295052607111504100201812395360000, 198733207159513356564952258990815169457553531939732, 196674645821672899295052607111504100201812395360000, 193226434212468354079118495168266960040776348088256, 175331775793370462115241462724333929074293393867520, 167204021151853212662608814079017628501887344452960, 138379936357501952378796118962138591016290462816000, 127858950927386995749143067101490491443519383177024, 95959548040808070000622624507574345582154453400320, 85732083830555006732684990825512886202499232739696, 57978544576590464601460625098386118150173899431680, 49974302542215931588631238936830276978407594785984, 30236839994528604808615458319995804975692830532352, 25080565949033011339875348952364709973370866873632, 13465905167967047080062395375917265390736583603968, 10717094076686248539103928870388198624329608954944, 5056996280703946342648090043461458222059373042432, 3848077549121593876801073689956962326064810923752, 1577211470360489239443278376084981541943207421696, 1142520371886225507258615533287185701215677518784, 400838617126973695105286777064412603473840311040, 274893260285370719387522767937578044057827020512, 80998008297602388272944457164032824856361467648, 52206098008685783398159390433478861390956549952, 12592397456256892225403940909715902681214698240, 7551720984449704479505511794244470880467880400, 1437836505550193327477852270574828479727707904, 790553633521399101089731498091733237499201728, 112356363240449893527012726216417415370656512, 55278855231444391313619763293618246887128224, 5311604025675027246268177825621690728251136, 2227990228659867734240778630765474886071360, 113517180990217669106751905438502372557568, 35917545547686059365808220080151141317043]
"""
